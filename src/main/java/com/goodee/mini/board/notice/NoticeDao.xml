<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.goodee.mini.board.notice.NoticeDao">
 
 	<resultMap type="NoticeVO" id="noticeResultMap">
 		<id column="board_no" property="boardNo"/>
 		<result column="mem_no" property="memNo"/>
 		<result column="board_title" property="boardTitle"/>
 		<result column="board_content" property="boardContent"/>
 		<result column="board_date" property="boardDate"/>
 		<result column="board_hit" property="boardHit"/>
 		<association property="boardFileVO" javaType="BoardFileVO">
 			<id column="attach_no" property="attachNo"/>
 			<result column="ori_name" property="oriName"/>
 			<result column="save_name" property="saveName"/>
 		</association>
 	</resultMap>
	
	<sql id="search">
  		WHERE
  		<choose>
  			<when test="kind=='s1'">
  				board_title
  			</when>
  			<when test="kind=='s2'">
  				board_content
  			</when>
  			<otherwise>
  				board_title
  			</otherwise>
  		</choose> 
  		LIKE CONCAT ('%', #{keyword}, '%')
  	</sql>
	
	<select id="list" resultType="NoticeVO" parameterType="Pager">
		SELECT * FROM NOTICE
		<include refid="search"></include>
		ORDER BY board_no DESC
		LIMIT #{startIndex}, #{endIndex}
	</select>
	
	<select id="totalCount" resultType="Long" parameterType="Pager">
		SELECT COUNT(board_no) FROM NOTICE
		<include refid="search"></include>	
	</select>
	
	<select id="detail" parameterType="BoardVO" resultMap="noticeResultMap">
		SELECT * FROM NOTICE
		LEFT JOIN NOTICE_ATTACH USING(board_no)
		WHERE board_no = #{boardNo}
	</select>
	
<!-- 	<select id="totalCount" resultType="Long" parameterType="Pager"> -->
<!-- 		SELECT COUNT(board_no) FROM NOTICE -->
<!-- 		<include refid="search"></include> -->
<!-- 	</select> -->
	
	<insert id="add" parameterType="BoardVO" useGeneratedKeys="true" keyProperty="boardNo">
		INSERT INTO NOTICE (mem_no, board_title, board_content, board_date, board_hit)
		VALUES (#{memNo}, #{boardTitle}, #{boardContent}, now(), 0)
	</insert>
	
	<update id="update">
		UPDATE NOTICE
		SET board_title = #{boardTitle}, board_content = #{boardContent}
		WHERE board_no = #{boardNo}
	</update>
	
	<insert id="addFile" parameterType="BoardFileVO">
		INSERT INTO NOTICE_ATTACH (board_no, ori_name, save_name)
		VALUES (#{boardNo}, #{oriName}, #{saveName})
	</insert>
	
	<select id="fileDetail" parameterType="BoardFileVO" resultType="BoardFileVO">
		SELECT * FROM NOTICE_ATTACH
		WHERE attach_no = #{attachNo}
	</select>
	
	<delete id="fileDelete" parameterType="BoardFileVO">
		DELETE FROM NOTICE_ATTACH
		WHERE attach_no = #{attachNo}
	</delete>
	
	<delete id="delete" parameterType="BoardVO">
		DELETE FROM NOTICE
		WHERE board_no = #{boardNo}
	</delete>
 
</mapper>
  
  
